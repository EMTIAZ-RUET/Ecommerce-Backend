syntax = "proto3";
package com.ironsoftware.product;

option java_multiple_files = true;
option java_package = "com.ironsoftware.productservice.grpc";

service ProductService {
  rpc GetProduct (GetProductRequest) returns (ProductResponse) {}
  rpc CheckStock (CheckStockRequest) returns (StockResponse) {}
  rpc ReserveStock (ReserveStockRequest) returns (ReserveStockResponse) {}
}

message GetProductRequest {
  string product_id = 1;
}

message ProductResponse {
  string id = 1;
  string name = 2;
  string description = 3;
  double price = 4;
  int32 stock_quantity = 5;
  repeated ProductVariant variants = 6;
}

message ProductVariant {
  string id = 1;
  string name = 2;
  string sku = 3;
  double price = 4;
  int32 stock_quantity = 5;
  map<string, string> attributes = 6;
}

message CheckStockRequest {
  string product_id = 1;
  string variant_id = 2;
  int32 quantity = 3;
}

message StockResponse {
  bool in_stock = 1;
  int32 available_quantity = 2;
}

message ReserveStockRequest {
  string order_id = 1;
  repeated StockReservationItem items = 2;
}

message StockReservationItem {
  string product_id = 1;
  string variant_id = 2;
  int32 quantity = 3;
}

message ReserveStockResponse {
  bool success = 1;
  string reservation_id = 2;
  repeated ReservationError errors = 3;
}

message ReservationError {
  string product_id = 1;
  string variant_id = 2;
  string error_message = 3;
}
